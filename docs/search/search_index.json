{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Thorstream Documentation","text":"<p>Thorstream is a Rust event streaming broker with Kafka-like behavior and compatibility APIs.</p>"},{"location":"#start-here","title":"Start here","text":"<ul> <li>Architecture</li> <li>Operations</li> <li>Deployment TLS</li> <li>Kubernetes</li> <li>Security</li> <li>Release Checklist</li> <li>UI Guide</li> </ul>"},{"location":"#quick-commands","title":"Quick commands","text":"<p>Run broker with compatibility API:</p> <pre><code>THORSTREAM_COMPAT_API_ADDR=127.0.0.1:8083 cargo run --bin thorstream\n</code></pre> <p>Run React UI:</p> <pre><code>cd ui\nnpm install\nnpm run dev\n</code></pre>"},{"location":"ARCHITECTURE/","title":"Thorstream Architecture","text":"<p>Related docs: Operations \u00b7 Deployment TLS \u00b7 Kubernetes \u00b7 Security \u00b7 Docs Index</p>"},{"location":"ARCHITECTURE/#high-level-components","title":"High-level components","text":"<ul> <li><code>broker</code>: topic/partition ownership, produce/fetch routing, offsets.</li> <li><code>storage</code>: append-only partition logs and segment files.</li> <li><code>server</code>: custom wire protocol and Kafka wire protocol endpoints.</li> <li><code>protocol</code>: request/response codecs and Kafka binary protocol handlers.</li> <li><code>cluster</code>: leader election loop, peer ping, replication RPC, quorum ack logic.</li> </ul>"},{"location":"ARCHITECTURE/#data-flow-write","title":"Data flow (write)","text":"<ol> <li>Client sends <code>Produce</code> (custom protocol or Kafka).</li> <li>Request reaches server dispatcher.</li> <li>Leader check (<code>Broker::is_leader</code>).</li> <li>Leader appends locally (<code>Broker::produce</code>).</li> <li>Record is replicated to peers via cluster RPC (<code>cluster::replicate_to_quorum</code>).</li> <li>Quorum ack returns success.</li> </ol>"},{"location":"ARCHITECTURE/#data-flow-read","title":"Data flow (read)","text":"<ol> <li>Client sends <code>Fetch</code>.</li> <li>Server reads from leader local log (<code>Broker::fetch</code>).</li> <li>Response includes records and high-water-mark.</li> </ol>"},{"location":"ARCHITECTURE/#leader-election","title":"Leader election","text":"<ul> <li>Control plane performs periodic peer pings.</li> <li>Leader is elected from reachable nodes with deterministic lowest node id rule.</li> <li>On node failure, remaining nodes re-elect.</li> </ul>"},{"location":"ARCHITECTURE/#recovery-model","title":"Recovery model","text":"<ul> <li>Broker scans data directory at startup to rebuild topics and partitions.</li> <li>Segment offsets are recovered from on-disk record stream.</li> <li>Replicated local data is loaded similarly on restart.</li> </ul>"},{"location":"ARCHITECTURE/#current-limitations","title":"Current limitations","text":"<ul> <li>Election is deterministic heartbeat-based, not full Raft-log consensus yet.</li> <li>Membership changes are static (from startup config/env).</li> <li>Snapshot shipping and log compaction for cluster replication are not yet implemented.</li> </ul>"},{"location":"DEPLOYMENT_TLS/","title":"Deployment: Compatibility API behind Reverse Proxy + TLS","text":"<p>Related docs: Operations \u00b7 Security \u00b7 Kubernetes \u00b7 Docs Index</p> <p>This guide deploys Thorstream with Kafka protocol and compatibility API, while terminating TLS at a reverse proxy.</p>"},{"location":"DEPLOYMENT_TLS/#goal-architecture","title":"Goal architecture","text":"<ul> <li>Thorstream Kafka wire protocol: <code>127.0.0.1:9093</code></li> <li>Thorstream compatibility API (Connect + Schema Registry): <code>127.0.0.1:8083</code></li> <li>Public HTTPS endpoint for compatibility API: <code>https://compat.example.com</code></li> <li>TLS termination at NGINX (or compatible proxy)</li> </ul>"},{"location":"DEPLOYMENT_TLS/#1-run-thorstream-on-loopback-interfaces","title":"1) Run Thorstream on loopback interfaces","text":"<pre><code>THORSTREAM_ADDR=127.0.0.1:9092 \\\nTHORSTREAM_KAFKA_ADDR=127.0.0.1:9093 \\\nTHORSTREAM_COMPAT_API_ADDR=127.0.0.1:8083 \\\nRUST_LOG=info \\\ncargo run --bin thorstream\n</code></pre> <p>For production, run the binary directly or via systemd rather than <code>cargo run</code>.</p>"},{"location":"DEPLOYMENT_TLS/#2-nginx-tls-reverse-proxy-for-compatibility-api","title":"2) NGINX TLS reverse proxy for compatibility API","text":"<p>Example NGINX server block:</p> <pre><code>server {\n    listen 443 ssl http2;\n    server_name compat.example.com;\n\n    ssl_certificate     /etc/letsencrypt/live/compat.example.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/compat.example.com/privkey.pem;\n\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_prefer_server_ciphers on;\n    ssl_session_timeout 1d;\n    ssl_session_cache shared:TLSCache:10m;\n\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n\n    location / {\n        proxy_pass http://127.0.0.1:8083;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto https;\n        proxy_read_timeout 120s;\n    }\n}\n\nserver {\n    listen 80;\n    server_name compat.example.com;\n    return 301 https://$host$request_uri;\n}\n</code></pre> <p>Reload NGINX:</p> <pre><code>sudo nginx -t &amp;&amp; sudo systemctl reload nginx\n</code></pre>"},{"location":"DEPLOYMENT_TLS/#3-systemd-service-for-thorstream","title":"3) systemd service for Thorstream","text":"<p>Example unit file at <code>/etc/systemd/system/thorstream.service</code>:</p> <pre><code>[Unit]\nDescription=Thorstream broker\nAfter=network.target\n\n[Service]\nType=simple\nUser=thorstream\nGroup=thorstream\nWorkingDirectory=/opt/thorstream\nEnvironment=RUST_LOG=info\nEnvironment=THORSTREAM_ADDR=127.0.0.1:9092\nEnvironment=THORSTREAM_KAFKA_ADDR=127.0.0.1:9093\nEnvironment=THORSTREAM_COMPAT_API_ADDR=127.0.0.1:8083\nExecStart=/opt/thorstream/target/release/thorstream\nRestart=always\nRestartSec=2\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Enable and start:</p> <pre><code>sudo systemctl daemon-reload\nsudo systemctl enable thorstream\nsudo systemctl start thorstream\nsudo systemctl status thorstream\n</code></pre>"},{"location":"DEPLOYMENT_TLS/#4-validation-checks","title":"4) Validation checks","text":"<p>Compatibility API over TLS:</p> <pre><code>curl -sSf https://compat.example.com/connector-plugins | jq\ncurl -sSf https://compat.example.com/subjects | jq\n</code></pre> <p>Kafka protocol listener (local smoke):</p> <pre><code>nc -zv 127.0.0.1 9093\n</code></pre>"},{"location":"DEPLOYMENT_TLS/#5-hardening-recommendations","title":"5) Hardening recommendations","text":"<ul> <li>Keep Thorstream listeners on loopback if a proxy is fronting traffic.</li> <li>Restrict firewall ingress to only required public ports (<code>443</code> and optionally Kafka listener if exposed).</li> <li>Run Thorstream as non-root user.</li> <li>Rotate TLS certificates automatically (e.g., certbot timer).</li> <li>Centralize logs and alert on restart loops.</li> <li>Backup <code>data/</code> with filesystem snapshots.</li> </ul>"},{"location":"DEPLOYMENT_TLS/#6-optional-expose-kafka-listener-with-tls-proxy","title":"6) Optional: expose Kafka listener with TLS proxy","text":"<p>Kafka protocol is binary and typically terminated by Kafka-aware proxies or stunnel/TCP TLS terminators. If you expose Kafka externally, use a TCP TLS proxy and network ACLs.</p>"},{"location":"DOCS_INDEX/","title":"Documentation Index","text":"<p>Use this page as a quick map across Thorstream docs.</p> <ul> <li>Docs Home</li> <li>Architecture</li> <li>Operations</li> <li>Deployment TLS</li> <li>Kubernetes</li> <li>Enterprise Security</li> <li>Release Checklist</li> <li>UI Guide</li> </ul>"},{"location":"KUBERNETES/","title":"Kubernetes-First Deployment","text":"<p>Related docs: Architecture \u00b7 Operations \u00b7 Deployment TLS \u00b7 Security \u00b7 Docs Index</p> <p>Thorstream supports a Kubernetes-first, near-stateless deployment model:</p> <ul> <li>Brokers run as <code>Deployment</code> (not <code>StatefulSet</code>) for fast scaling.</li> <li>Local state uses <code>emptyDir</code> for speed.</li> <li>Durable history is mirrored to object-store-backed volume via <code>THORSTREAM_OBJECT_STORE_DIR</code>.</li> <li>HPA scales broker count by CPU and memory.</li> </ul>"},{"location":"KUBERNETES/#included-manifests","title":"Included manifests","text":"<ul> <li><code>deploy/k8s/thorstream-deployment.yaml</code></li> <li><code>deploy/k8s/thorstream-hpa.yaml</code></li> </ul>"},{"location":"KUBERNETES/#apply","title":"Apply","text":"<pre><code>kubectl apply -f deploy/k8s/thorstream-deployment.yaml\nkubectl apply -f deploy/k8s/thorstream-hpa.yaml\n</code></pre>"},{"location":"KUBERNETES/#object-store-backed-durability","title":"Object-store-backed durability","text":"<p>Set:</p> <ul> <li><code>THORSTREAM_OBJECT_STORE_DIR=/var/thorstream-object-store</code></li> <li><code>THORSTREAM_OBJECT_STORE_REQUIRED=true</code></li> </ul> <p>Behavior:</p> <ol> <li>On append, records are mirrored to object-store-backed segment files.</li> <li>On startup, if local segment is empty/missing, broker restores from object-store mirror.</li> </ol> <p>This enables near-stateless brokers with quick pod replacement and lower ops overhead.</p>"},{"location":"KUBERNETES/#auto-scaling-guidance","title":"Auto-scaling guidance","text":"<ul> <li>Start with <code>minReplicas=2</code> and <code>maxReplicas=12</code>.</li> <li>Keep broker CPU request realistic (e.g., <code>250m</code>+) for stable HPA decisions.</li> <li>Use PDB to preserve quorum/availability during node maintenance.</li> </ul>"},{"location":"KUBERNETES/#production-notes","title":"Production notes","text":"<ul> <li>Back object-store PVC with S3-compatible CSI / gateway or mounted object storage.</li> <li>Keep compatibility APIs behind Ingress + TLS/mTLS.</li> <li>Use cluster-autoscaler alongside HPA for node elasticity.</li> <li>Forward audit logs to centralized logging.</li> </ul>"},{"location":"OPERATIONS/","title":"Operations Guide","text":"<p>Related docs: Architecture \u00b7 Deployment TLS \u00b7 Kubernetes \u00b7 Release Checklist \u00b7 Docs Index</p>"},{"location":"OPERATIONS/#environment-variables","title":"Environment variables","text":"<ul> <li><code>THORSTREAM_ADDR</code> (default <code>0.0.0.0:9092</code>)</li> <li><code>THORSTREAM_KAFKA_ADDR</code> (optional Kafka wire protocol listener)</li> <li><code>THORSTREAM_KAFKA_PORT</code> (metadata broker port hint)</li> <li><code>THORSTREAM_NODE_ID</code> (cluster node id)</li> <li><code>THORSTREAM_CLUSTER_PEERS</code> format: <code>1=127.0.0.1:9101,2=127.0.0.1:9102</code></li> <li><code>THORSTREAM_COMPAT_API_ADDR</code> (optional Connect + Schema Registry compatibility API, e.g. <code>127.0.0.1:8083</code>)</li> </ul>"},{"location":"OPERATIONS/#single-node-run","title":"Single-node run","text":"<pre><code>cargo run --bin thorstream\n</code></pre>"},{"location":"OPERATIONS/#3-node-local-cluster-example","title":"3-node local cluster example","text":"<p>Node 0:</p> <pre><code>THORSTREAM_NODE_ID=0 \\\nTHORSTREAM_ADDR=127.0.0.1:9100 \\\nTHORSTREAM_CLUSTER_PEERS=\"1=127.0.0.1:9101,2=127.0.0.1:9102\" \\\ncargo run --bin thorstream\n</code></pre> <p>Node 1:</p> <pre><code>THORSTREAM_NODE_ID=1 \\\nTHORSTREAM_ADDR=127.0.0.1:9101 \\\nTHORSTREAM_CLUSTER_PEERS=\"0=127.0.0.1:9100,2=127.0.0.1:9102\" \\\ncargo run --bin thorstream\n</code></pre> <p>Node 2:</p> <pre><code>THORSTREAM_NODE_ID=2 \\\nTHORSTREAM_ADDR=127.0.0.1:9102 \\\nTHORSTREAM_CLUSTER_PEERS=\"0=127.0.0.1:9100,1=127.0.0.1:9101\" \\\ncargo run --bin thorstream\n</code></pre>"},{"location":"OPERATIONS/#health-checks","title":"Health checks","text":"<ul> <li>Verify logs for leader transitions.</li> <li>Run integration tests and cluster tests before deploy:</li> <li><code>cargo test --test cluster_fault_tolerance_test</code></li> <li><code>cargo test</code></li> </ul>"},{"location":"OPERATIONS/#backup-and-restore","title":"Backup and restore","text":"<ul> <li>Backup <code>data/</code> atomically (filesystem snapshot preferred).</li> <li>Restore by replacing <code>data/</code> and restarting nodes.</li> </ul>"},{"location":"OPERATIONS/#deployment","title":"Deployment","text":"<ul> <li>For production reverse-proxy and TLS setup of compatibility APIs, see <code>documentation/DEPLOYMENT_TLS.md</code>.</li> </ul>"},{"location":"RELEASE_CHECKLIST/","title":"Release Checklist","text":"<p>Related docs: Operations \u00b7 Architecture \u00b7 Security \u00b7 Docs Index</p>"},{"location":"RELEASE_CHECKLIST/#pre-release","title":"Pre-release","text":"<ul> <li>[ ] Update <code>CHANGELOG.md</code> for the release version.</li> <li>[ ] Verify <code>README.md</code> reflects current behavior and limitations.</li> <li>[ ] Run formatting: <code>cargo fmt --all -- --check</code>.</li> <li>[ ] Run linting: <code>cargo clippy --all-targets --all-features -- -D warnings</code>.</li> <li>[ ] Run tests: <code>cargo test</code>.</li> <li>[ ] Smoke benchmark build: <code>cargo bench --no-run</code>.</li> </ul>"},{"location":"RELEASE_CHECKLIST/#validation","title":"Validation","text":"<ul> <li>[ ] Single-node produce/fetch smoke test.</li> <li>[ ] Cluster failover smoke test (3 nodes).</li> <li>[ ] Kafka compatibility smoke test.</li> </ul>"},{"location":"RELEASE_CHECKLIST/#publication","title":"Publication","text":"<ul> <li>[ ] Tag release in git.</li> <li>[ ] Publish GitHub release notes from <code>CHANGELOG.md</code>.</li> <li>[ ] Attach benchmark summary and known limitations.</li> </ul>"},{"location":"SECURITY_ENTERPRISE/","title":"Enterprise Security","text":"<p>Related docs: Deployment TLS \u00b7 Operations \u00b7 Release Checklist \u00b7 Docs Index</p> <p>Thorstream includes enterprise security foundations for authentication, authorization, and auditing.</p>"},{"location":"SECURITY_ENTERPRISE/#tls-mtls","title":"TLS / mTLS","text":"<ul> <li>For production deployment of the compatibility API, terminate TLS at a reverse proxy as documented in <code>documentation/DEPLOYMENT_TLS.md</code>.</li> <li>mTLS can be enforced at the reverse proxy layer for compatibility APIs.</li> <li>For Kafka/custom binary listeners, use a TCP TLS/mTLS terminator (stunnel, Envoy, HAProxy TCP mode) in front of Thorstream.</li> </ul>"},{"location":"SECURITY_ENTERPRISE/#sasl-mechanisms","title":"SASL mechanisms","text":"<p>Thorstream provides pluggable SASL credential/token validation primitives for:</p> <ul> <li><code>PLAIN</code></li> <li><code>SCRAM-SHA-256</code></li> <li><code>SCRAM-SHA-512</code></li> <li><code>OAUTHBEARER</code></li> </ul> <p>Configuration:</p> <ul> <li><code>THORSTREAM_SASL_PLAIN_USERS</code> = <code>alice:secret,bob:pwd</code></li> <li><code>THORSTREAM_SASL_SCRAM_USERS</code> = <code>svc:scram-secret</code></li> <li><code>THORSTREAM_SASL_OAUTH_TOKENS</code> = <code>token-1,token-2</code></li> </ul>"},{"location":"SECURITY_ENTERPRISE/#kafka-compatible-acl-model","title":"Kafka-compatible ACL model","text":"<p>Thorstream supports Kafka-style ACL semantics with principal, operation, resource type, and permission.</p> <p>Rule format (<code>THORSTREAM_ACL_RULES</code>):</p> <p><code>principal|operation|resource_type|resource_pattern|permission</code></p> <ul> <li><code>operation</code>: <code>READ</code>, <code>WRITE</code>, <code>DESCRIBE</code>, <code>ALTER</code>, <code>CLUSTER_ACTION</code></li> <li><code>resource_type</code>: <code>TOPIC</code>, <code>GROUP</code>, <code>CLUSTER</code></li> <li><code>permission</code>: <code>ALLOW</code>, <code>DENY</code></li> <li><code>resource_pattern</code>: exact, wildcard <code>*</code>, or prefix wildcard like <code>payments-*</code></li> </ul> <p>Example:</p> <pre><code>THORSTREAM_ACL_RULES=\"alice|WRITE|TOPIC|payments-*|ALLOW;alice|READ|TOPIC|payments-*|ALLOW;ops|DESCRIBE|CLUSTER|*|ALLOW\"\nTHORSTREAM_ACL_DEFAULT_ALLOW=false\n</code></pre>"},{"location":"SECURITY_ENTERPRISE/#rbac-nice-to-have","title":"RBAC (nice-to-have)","text":"<p>Thorstream includes built-in role bindings for convenience:</p> <ul> <li><code>admin</code>: broad cluster + topic read/write permissions</li> <li><code>developer</code>: topic read/write + cluster describe</li> <li><code>viewer</code>: topic read + cluster describe</li> </ul> <p>Bind roles with:</p> <pre><code>THORSTREAM_RBAC_BINDINGS=\"alice=admin;bob=viewer\"\n</code></pre>"},{"location":"SECURITY_ENTERPRISE/#audit-logs","title":"Audit logs","text":"<p>All authorization checks can be written as JSON lines with:</p> <pre><code>THORSTREAM_AUDIT_LOG_PATH=/var/log/thorstream/audit.log\n</code></pre> <p>Each event includes:</p> <ul> <li>timestamp</li> <li>principal</li> <li>operation</li> <li>resource type/name</li> <li>allow/deny result</li> <li>reason</li> </ul>"},{"location":"SECURITY_ENTERPRISE/#example-secure-run","title":"Example secure run","text":"<pre><code>THORSTREAM_DEFAULT_PRINCIPAL=alice \\\nTHORSTREAM_SASL_PLAIN_USERS=\"alice:secret\" \\\nTHORSTREAM_ACL_RULES=\"alice|WRITE|TOPIC|events-*|ALLOW;alice|READ|TOPIC|events-*|ALLOW;alice|DESCRIBE|CLUSTER|*|ALLOW\" \\\nTHORSTREAM_ACL_DEFAULT_ALLOW=false \\\nTHORSTREAM_AUDIT_LOG_PATH=./thorstream-audit.log \\\nTHORSTREAM_COMPAT_API_ADDR=127.0.0.1:8083 \\\ncargo run --bin thorstream\n</code></pre>"},{"location":"UI/","title":"UI Guide","text":"<p>Thorstream UI is a React + shadcn-style dashboard for operations and ecosystem compatibility workflows.</p>"},{"location":"UI/#features","title":"Features","text":"<ul> <li>Operational metrics dashboard from <code>/metrics</code></li> <li>under-replicated partitions</li> <li>request latency p99</li> <li>produce/fetch throughput (records and bytes)</li> <li>consumer lag</li> <li>partition size</li> <li>Auto-refresh with alert panel for common health signals</li> <li>Kafka Connect compatibility workflows</li> <li>plugin catalog</li> <li>connector list/create/pause/resume/delete</li> <li>Schema Registry compatibility workflows</li> <li>subject list</li> <li>schema registration</li> <li>compatibility checks</li> </ul>"},{"location":"UI/#run","title":"Run","text":"<pre><code>cd ui\nnpm install\nnpm run dev\n</code></pre> <p>Default API base in the UI is <code>/api</code> via Vite proxy to <code>http://127.0.0.1:8083</code>.</p>"},{"location":"UI/#build","title":"Build","text":"<pre><code>cd ui\nnpm run build\nnpm run preview\n</code></pre>"},{"location":"UI/#related-docs","title":"Related docs","text":"<ul> <li>Operations</li> <li>Deployment TLS</li> <li>Security</li> </ul>"}]}